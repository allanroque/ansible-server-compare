---
- name: Ansible Server Compare - Fluxo Completo
  hosts: all
  become: yes
  gather_facts: yes

  tasks:
    - name: Display start message
      ansible.builtin.debug:
        msg: |
          ========================================
          INICIANDO AN√ÅLISE DE SERVIDORES
          ========================================
          
          Este playbook ir√°:
          1. Coletar informa√ß√µes dos servidores
          2. Comparar configura√ß√µes
          3. Gerar relat√≥rio web
          4. Configurar Apache
          
          ========================================

- name: Collect server information
  hosts: servers
  become: yes
  gather_facts: yes
  
  pre_tasks:
    - name: Create reports directory
      ansible.builtin.file:
        path: reports
        state: directory
        mode: '0755'
      delegate_to: localhost
      run_once: true

  roles:
    - server_info

- name: Generate comparison and setup web interface
  hosts: webserver
  become: yes
  gather_facts: yes
  
  tasks:
    - name: Generate comparison data
      ansible.builtin.include_tasks: ../roles/server_info/tasks/generate_comparison.yml
      delegate_to: localhost
      run_once: true

    - name: Setup Apache web interface
      ansible.builtin.include_tasks: ../roles/web_setup/tasks/main.yml

    - name: Display completion message
      ansible.builtin.debug:
        msg: |
          ========================================
          AN√ÅLISE CONCLU√çDA COM SUCESSO!
          ========================================
          
          ‚úÖ Informa√ß√µes coletadas dos servidores
          ‚úÖ Compara√ß√£o realizada
          ‚úÖ Relat√≥rio web gerado
          ‚úÖ Apache configurado
          
          üåê Acesse o relat√≥rio em: http://localhost/report
          
          üìÅ Arquivos gerados em: ./reports/
          
          ========================================
